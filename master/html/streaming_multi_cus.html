

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="keywords" content="Vitis, library, Database, Quantitative Finance, Vision, Data Compression, Security, Solver, BLAS, Hardware, xfOpenCV, xfdatabase, xffintech, xfcompression, xfsecurity, xfsolver, xfblas, xfhardware"/>
<meta name="description" content="Vitis software development platform includes an extensive set of open-source, performance-optimized libraries that offer out-of-the-box acceleration with minimal to zero-code changes to your existing applications, without the need to reimplement your algorithms from scratch to harness the benefits of Xilinx adaptive compute."/>
<meta name="xlnxdocumentclass" content="Document"> 
<meta name="xlnxdocumenttypes" content="Tutorials"> 
<!-- Header information provided by Emily-->
    <meta name="Language" content="en">
    <meta name="Location" content="us">
    <link rel="icon" type="image/vnd.microsoft.icon" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/favicon.ico">
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/favicon.ico">
  
  <title>Stream Multiple Compute Units &mdash; VITIS ACCEL EXAMPLES  documentation</title>
  
<!-- Header information provided by Emily-->
    <meta name="apple-itunes-app" content="app-id=1063287962">
    <meta name="google-play-app" content="app-id=com.marketing.xilinxgo">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://kit.fontawesome.com/d3dd8c60ed.js"></script>
    
    <link rel="stylesheet" href="https://www.xilinx.com/etc.clientlibs/clientlibs/granite/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/header-footer.min.css" type="text/css">
    <link rel="stylesheet" href="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all.min.css" type="text/css">
    
    <script type="text/javascript" src="https://www.xilinx.com/etc.clientlibs/clientlibs/granite/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.xilinx.com/etc.clientlibs/clientlibs/granite/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/header-footer.min.js"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css">
  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Stream Simple" href="streaming_simple.html" />
    <link rel="prev" title="Stream Memory Map Mixed" href="streaming_mm_mixed.html" /> 
</head>

<body class="wy-body-for-nav">
<div class="xilinx-bs3">
    <noindex>
        <header data-component="header">
            <nav class="navbar navbar-default">
                <div class="container main-nav">
                    <div class="row">
                        <div class="col-xs-5 col-sm-2 logo-column">
                            <div class="logo">
                                <a href="https://www.xilinx.com/">
                                    <img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc" />
                                </a>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-8 navbar-column">
                            <div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
                                <ul class="nav navbar-nav nav-justified">
                                    <li class="accordion-toggle-icons" data-component="toggle-dropdown">
                                        <a href="https://developer.xilinx.com/">
                                            Developers
                                        </a>
                                    </li>
                                    <li class="accordion-toggle-icons" data-component="toggle-dropdown">
                                        <a href="https://www.xilinx.com/support.html">
                                            Support
                                        </a>
                                    </li>
                                    <li class="accordion-toggle-icons" data-component="toggle-dropdown">
                                        <a href="https://forums.xilinx.com/">
                                            Forums
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="mini-nav col-sm-2">
                            <button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
                                <span></span>
                                <span></span>
                                <span></span>
                                <span></span>
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
        </header>
    </noindex>
</div>
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> VITIS ACCEL EXAMPLES
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="shells.html">Supported Shells</a></li>
<li class="toctree-l1"><a class="reference internal" href="compile_execute.html">Compilation and Execution</a></li>
</ul>
<p class="caption"><span class="caption-text">Category of Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hello_world.html">Hello World</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="host.html">Host</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="concurrent_kernel_execution.html">Concurrent Kernel Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="copy_buffer.html">Copy Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_transfer.html">Data Transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_query.html">Device Query (CPP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_profile.html">Debug Profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors_cpp.html">Error Handling (CPP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="hbm_bandwidth.html">HBM Bandwidth</a></li>
<li class="toctree-l2"><a class="reference internal" href="hbm_simple.html">HBM Simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="host_global_bandwidth.html">Host Global Bandwidth</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_cus_asymmetrical.html">Multiple Compute Units (Asymmetrical)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mult_compute_units.html">Multiple Compute Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="overlap.html">Overlap Host and Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="p2p_simple.html">P2P Simple Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="p2p_bandwidth.html">P2P bandwidth Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_host_bandwidth.html">Streaming Host to Kernel Bandwidth</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_free_running_kernel.html">Stream Free Running Kernel (HLS C/C++)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_only_buffer.html">Device Only Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_k2k.html">Stream Kernel to Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_k2k_mm.html">Stream Kernel to Kernel Memory Mapped</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_mm_mixed.html">Stream Memory Map Mixed</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Stream Multiple Compute Units</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#excluded-platforms">EXCLUDED PLATFORMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#design-files">DESIGN FILES</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-arguments">COMMAND LINE ARGUMENTS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="streaming_simple.html">Stream Simple</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">C++ Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="sys_opt.html">System Optimization Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="rtl.html">RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocl.html">OpenCL Kernels</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Files</a></li>
</ul>

            
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="_sources/streaming_multi_cus.rst.txt"
						rel="nofollow">Show Source</a></li>						
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VITIS ACCEL EXAMPLES</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="host.html">Host</a> &raquo;</li>
        
      <li>Stream Multiple Compute Units</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/streaming_multi_cus.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stream-multiple-compute-units">
<h1>Stream Multiple Compute Units<a class="headerlink" href="#stream-multiple-compute-units" title="Permalink to this headline">¶</a></h1>
<p>This is a simple vadd Kernel design in which multiple compute units of
kernel are directly communicating with host using stream interfaces.</p>
<p><strong>KEY CONCEPTS:</strong> Read/Write Stream, Create/Release Stream</p>
<p><strong>KEYWORDS:</strong> cl_stream, CL_STREAM_EOT, nk</p>
<p>This is a simple vadd Kernel design in which multiple compute units of
kernel are directly communicating with host using stream interfaces.</p>
<p>For this examples, four compute units of a kernel is created.
<code class="docutils literal notranslate"><span class="pre">krnl_stream_vadd.ini</span></code> file specifies number of compute units along
with name of each compute unit as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">connectivity</span><span class="p">]</span>
<span class="n">nk</span><span class="o">=</span><span class="n">krnl_stream_vadd</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="n">vadd_1</span><span class="o">.</span><span class="n">vadd_2</span><span class="o">.</span><span class="n">vadd_3</span><span class="o">.</span><span class="n">vadd_4</span>
</pre></div>
</div>
<p>This file is included to v++ command line using following statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">config</span> <span class="n">krnl_stream_vadd</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>Host is written configurable for number of compute units using top level
const variable <code class="docutils literal notranslate"><span class="pre">NCU</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">constexpr</span> <span class="n">NCU</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</pre></div>
</div>
<p>User just needs to change NCU to some other value to make the host code
ready for other numbers. But user still needs to manually update the
<code class="docutils literal notranslate"><span class="pre">krnl_stream_vadd.ini</span></code> file for other configuration.</p>
<p>For multiple compute units case, host codes needs to create kernel
object using specific compute unit name as below:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cu_id</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">krnl_name</span> <span class="o">=</span> <span class="s">&quot;krnl_stream_vadd&quot;</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="o">&gt;</span> <span class="n">krnls</span><span class="p">(</span><span class="n">NCU</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NCU</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">cu_id</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">krnl_name_full</span> <span class="o">=</span> <span class="n">krnl_name</span> <span class="o">+</span> <span class="s">&quot;:{&quot;</span> <span class="o">+</span> <span class="s">&quot;vadd_&quot;</span> <span class="o">+</span> <span class="n">cu_id</span> <span class="o">+</span> <span class="s">&quot;}&quot;</span><span class="p">;</span> <span class="c1">//kernel name with compute unit name</span>
    <span class="n">krnls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">krnl_name_full</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here compute unit should match to name provided in
<code class="docutils literal notranslate"><span class="pre">krnl_stream_vadd.ini</span></code> file.</p>
<p>Once we have unique kernel object for each compute unit, host code can
easily creates stream object for respective kernel object and transfer
data accordingly. For More details about streaming kernel usage, please
refer streaming_simple example.</p>
<div class="section" id="excluded-platforms">
<h2>EXCLUDED PLATFORMS<a class="headerlink" href="#excluded-platforms" title="Permalink to this headline">¶</a></h2>
<p>Platforms containing following strings in their names are not supported
for this example :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zc</span>
<span class="n">xdma</span>
<span class="n">xilinx_u250_qep</span>
<span class="n">aws</span>
<span class="n">samsung</span>
</pre></div>
</div>
</div>
<div class="section" id="design-files">
<h2>DESIGN FILES<a class="headerlink" href="#design-files" title="Permalink to this headline">¶</a></h2>
<p>Application code is located in the src directory. Accelerator binary
files will be compiled to the xclbin directory. The xclbin directory is
required by the Makefile and its contents will be filled during
compilation. A listing of all the files in this example is shown below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span><span class="o">/</span><span class="n">host</span><span class="o">.</span><span class="n">cpp</span>
<span class="n">src</span><span class="o">/</span><span class="n">krnl_stream_vadd</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
</div>
<div class="section" id="command-line-arguments">
<h2>COMMAND LINE ARGUMENTS<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h2>
<p>Once the environment has been configured, the application can be
executed by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">vadd_stream</span> <span class="o">&lt;</span><span class="n">krnl_stream_vadd</span> <span class="n">XCLBIN</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="streaming_simple.html" class="btn btn-neutral float-right" title="Stream Simple" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="streaming_mm_mixed.html" class="btn btn-neutral float-left" title="Stream Memory Map Mixed" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p>
        
        &copy; Copyright 2019, Xilinx

    </p>
  </div>
<!--
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 
-->
</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>